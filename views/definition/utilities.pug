mixin wordlink(q)
  a(href='/definition?q='+encodeURI(q))= q
mixin sentencelink(q)
  a(href='/definition?q='+encodeURI(query.input+"~"+q))= q

//- mixin test(q)
//-   q.replace(/\{-(.*?)\-}/g, '<a href="definition?q=$1">$1</a>')

//- mixin example(eg)
  //- eg.replace(/{-/g,'<a href="definition?q=').replace(/-:-/g,'">').replace(/-}/g,'</a>')

mixin format(tagName,e)
  #{tagName}(class!=attributes.class)!= e.replace(/\"(.+?)\"/g, '<q>$1</q>').replace(/\(-(.+?)-\)/g, '<small>$1</small>').replace(/\((.+?)\)/g, '<em>$1</em>').replace(/\{-(.+?)-\}/g, (_,q)=>'<a href="/definition?q='+encodeURI(q)+'">'+q+'</a>').replace(/\[(.*?)\]/g, '<b>$1</b>')

mixin message(raw)
  div.message
    ol
      each row in raw
        li
          p= row.msg
            if row.list && row.list.length
              | :
              each word in row.list
                | ~
                +wordlink(word)

//- NOTE: type
mixin meaning(row)
  each define,grammar in row
    div.pos(class=grammar)
      h2= grammar
      div
        each mean,ty in define
          div(class=mean.kind)
            +internal_casting_mean(mean.v)
            +internal_casting_exam(mean.exam)
            +internal_casting_usage(mean.usage)

//- NOTE: pos
mixin suggestion(raw)
  each row,name in raw
    div.suggestion(class=name)
      h3= name
      div
        +#{name}(row)

//- NOTE: pos
mixin thesaurus(raw)
  if raw && raw.length
    each row in raw
      div(class=row.kind)
        +examWord(row.v)

//- NOTE: type
mixin help(row)
  each define,grammar in row
    div.help(class=grammar)
      //- h3= grammar
      div
        each mean,ty in define
          helps-improve(row=mean)
          //- p= ty
          //- div(class=mean.kind)
          //-   +internal_casting_mean(mean.v)
          //-   +internal_casting_exam(mean.exam)
          //-   +internal_casting_usage(mean.usage)

mixin internal_casting_mean(o)
  if o
    if (typeof o === 'string')
      +format('p',o)
    else
      each e in o
        if (e.mean.length)
          div.mean
            each eg in e.mean
              +format('p',eg)
        if (e.exam.length)
          ul
            each eg in e.exam
              +format('li',eg)

    //- else if(o.mean.length)
    //-   +#{o.type}(o.mean)

mixin meanWord(raw)
  ol
    each eg in raw
      li
        +wordlink(eg)

mixin meanSentence(raw)
  ul
    each eg in raw
      +format('li',eg)

mixin internal_casting_exam(o)
  if o && o.value.length
    +#{o.type}(o.value)

mixin examWord(raw)
  ol
    each eg in raw
      li
        +wordlink(eg)

mixin examSentence(raw)
  ul
    each eg in raw
      +format('li',eg)

mixin internal_casting_usage(o)
  if o && o.value.length
    +#{o.type}(o.value)

mixin usageWord(raw)
  ol
    each eg in raw
      li
        +wordlink(eg)

mixin usageSentence(raw)
  ul
    each eg in raw
      +format('li',eg)


//- mixin notation(row)
//-   div.notation
//-     h2= row.number
//-     div
//-       each k in row.notation
//-         p= k.sense
//-           if row.alpha
//-             each num in row.alpha
//-               +wordlink(num)

//- mixin suggestion(row)
//-   if row.length
//-     div.suggestion
//-       p
//-         each word in row
//-           +wordlink(word)

//- mixin thesaurus(row)
//-   if row && row.length
//-     div.thesaurus.synonym
//-       h3 Thesaurus
//-       div
//-         ol
//-           each word in row
//-             li
//-               +wordlink(word)

mixin suggestion_spelling(o)
  div.suggestion(class=o.name)
    p Or you might interested in
      | !{' '}
      each w in o.list
        | !{' '} ~
        +wordlink(w)

mixin resultData(o)
  div.sense
    script  var sugList = !{JSON.stringify(meta.sug)}
    each sug in meta.sug
      //- script var orange = !{JSON.stringify(sug)}
      +#{"suggestion_"+sug.name}(sug)
    each row in o
      if Array.isArray(row.clue)
        +translation(row)
      else
        +definition(row)
  div.promote
    div.ads
      div ads

mixin translation(row, w)
  div.translation
    p= row.word
      speech-engine(word=row.word lang=lang.tar)
    div
      each e in row.clue
        +definition(e)

mixin definition(raw)
  div.definition
    div.word(data-lang=lang.tar)
      div
        h1= raw.word
          speech-engine(word=raw.word lang=lang.tar)
      div
        p ?
    if query.status
      p
        each eg in query.sentence
          +sentencelink(eg)
          | !{' '}
    div.lexicon
      div.ads
        div ads
      div.meaning
        each row, name in raw.clue
          +#{name}(row)